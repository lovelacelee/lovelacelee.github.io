/*! For license information please see Bmdb.min.js.LICENSE.txt */
/*!
  * Bmdb 1.8.1 (https://github.com/iMuFeng/bmdb)
  * Apply for secret at https://bm.weajs.com
  */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jQuery")):"function"==typeof define&&define.amd?define("Bmdb",["jQuery"],e):"object"==typeof exports?exports.Bmdb=e(require("jQuery")):t.Bmdb=e(t.jQuery)}(window,(function(t){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=25)}([function(e,r){e.exports=t},function(t,e,r){var i=r(21),n=r(22);t.exports=function(t){return function(t){return"string"==typeof t}(t)&&t.length?n(t):i(t)}},function(t,e,r){"use strict";t.exports=r(23)},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,r){var i=r(14),n="object"==typeof self&&self&&self.Object===Object&&self,o=i||n||Function("return this")();t.exports=o},function(t,e,r){var i=r(5).Symbol;t.exports=i},function(t,e,r){var i=r(4),n=r(13),o=r(15),s=Math.max,a=Math.min;t.exports=function(t,e,r){var c,u,l,f,h,d,p=0,g=!1,b=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var r=c,i=u;return c=u=void 0,p=e,f=t.apply(i,r)}function m(t){return p=t,h=setTimeout(j,e),g?y(t):f}function w(t){var r=t-d;return void 0===d||r>=e||r<0||b&&t-p>=l}function j(){var t=n();if(w(t))return x(t);h=setTimeout(j,function(t){var r=e-(t-d);return b?a(r,l-(t-p)):r}(t))}function x(t){return h=void 0,v&&c?y(t):(c=u=void 0,f)}function A(){var t=n(),r=w(t);if(c=arguments,u=this,d=t,r){if(void 0===h)return m(d);if(b)return clearTimeout(h),h=setTimeout(j,e),y(d)}return void 0===h&&(h=setTimeout(j,e)),f}return e=o(e)||0,i(r)&&(g=!!r.leading,l=(b="maxWait"in r)?s(o(r.maxWait)||0,e):l,v="trailing"in r?!!r.trailing:v),A.cancel=function(){void 0!==h&&clearTimeout(h),p=0,c=d=u=h=void 0},A.flush=function(){return void 0===h?f:x(n())},A}},function(t,e,r){r(2);t.exports=function(t){"use strict";t=t||{};return'<div class="bmdb-category"><ul></ul></div>','<div class="bmdb-category"><ul></ul></div>'}},function(t,e,r){var i=r(2);t.exports=function(t){"use strict";t=t||{};var e="",r=i.$each,n=t.categories,o=(t.$value,t.$index,i.$escape);return r(n,(function(t,r){e+=" <li><a ",t.active&&(e+=' class="bmdb-category-active" '),e+=' href="',e+=o(t.url),e+='" title="',e+=o(t.name),e+='"> ',e+=o(t.name),e+=" </a></li> "})),e}},function(t,e,r){var i=r(2);t.exports=function(t){"use strict";t=t||{};var e="",r=i.$each,n=t.skeletons;t.$value,t.$index;return e+='<div class="bmdb-list"><ul class="bmdb-ul"></ul></div><div class="bmdb-loader"><ul class="bmdb-ul"> ',r(n,(function(t,r){e+=' <li class="bmdb-li"><div class="bmdb-cover"></div><div class="bmdb-title"></div><div class="bmdb-rank"></div></li> '})),e+=" </ul></div>"}},function(t,e,r){var i=r(2);t.exports=function(t){"use strict";t=t||{};var e="",r=i.$each,n=t.data,o=(t.$value,t.$index,i.$escape);t.starValue;return r(n,(function(t,i){e+=' <li class="bmdb-li"><a href="',e+=o(t.doubanUrl),e+='" class="bmdb-link" target="_blank"><div class="bmdb-cover"><img class="bmdb-cover-image" ',e+='src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"',e+=' data-cover="',e+=o(t.cover),e+='" alt="',e+=o(t.title),e+='" width="150" height="220"></div><div class="bmdb-info"><div class="bmdb-title">',e+=o(t.title),e+='</div><div class="bmdb-rank"><span class="bmdb-rank-span bmdb-stars"> ',r(t.stars,(function(t,r){e+=" ",e+=t?' <span class="bmdb-star bmdb-star-full"></span> ':' <span class="bmdb-star bmdb-star-gray"></span> ',e+=" "})),e+=' </span><span class="bmdb-rank-span">',e+=o(t.rating),e+="</span></div></div></a></li> "})),e}},function(t,e,r){(function(e){var r;r=void 0!==e?e:this.window||this.global,t.exports=function(t){"use strict";t=window;const e={src:"data-src",srcset:"data-srcset",selector:".lazyload",root:null,rootMargin:"0px",threshold:0},r=function(){let t={},e=!1,i=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],i++);let o=function(i){for(let n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e&&"[object Object]"===Object.prototype.toString.call(i[n])?t[n]=r(!0,t[n],i[n]):t[n]=i[n])};for(;i<n;i++)o(arguments[i]);return t};function i(t,i){this.settings=r(e,i||{}),this.images=t||document.querySelectorAll(this.settings.selector),this.observer=null,this.init()}if(i.prototype={init:function(){if(!t.IntersectionObserver)return void this.loadImages();let e=this,r={root:this.settings.root,rootMargin:this.settings.rootMargin,threshold:[this.settings.threshold]};this.observer=new IntersectionObserver((function(t){Array.prototype.forEach.call(t,(function(t){if(t.isIntersecting){e.observer.unobserve(t.target);let r=t.target.getAttribute(e.settings.src),i=t.target.getAttribute(e.settings.srcset);"img"===t.target.tagName.toLowerCase()?(r&&(t.target.src=r),i&&(t.target.srcset=i)):t.target.style.backgroundImage="url("+r+")"}}))}),r),Array.prototype.forEach.call(this.images,(function(t){e.observer.observe(t)}))},loadAndDestroy:function(){this.settings&&(this.loadImages(),this.destroy())},loadImages:function(){if(!this.settings)return;let t=this;Array.prototype.forEach.call(this.images,(function(e){let r=e.getAttribute(t.settings.src),i=e.getAttribute(t.settings.srcset);"img"===e.tagName.toLowerCase()?(r&&(e.src=r),i&&(e.srcset=i)):e.style.backgroundImage="url('"+r+"')"}))},destroy:function(){this.settings&&(this.observer.disconnect(),this.settings=null)}},t.lazyload=function(t,e){return new i(t,e)},t.jQuery){const e=t.jQuery;e.fn.lazyload=function(t){return(t=t||{}).attribute=t.attribute||"data-src",new i(e.makeArray(this),t),this}}return i}(r)}).call(this,r(3))},function(t,e,r){var i=r(5);t.exports=function(){return i.Date.now()}},function(t,e,r){(function(e){var r="object"==typeof e&&e&&e.Object===Object&&e;t.exports=r}).call(this,r(3))},function(t,e,r){var i=r(4),n=r(16),o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(n(t))return NaN;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var r=a.test(t);return r||c.test(t)?u(t.slice(2),r?2:8):s.test(t)?NaN:+t}},function(t,e,r){var i=r(17),n=r(20);t.exports=function(t){return"symbol"==typeof t||n(t)&&"[object Symbol]"==i(t)}},function(t,e,r){var i=r(6),n=r(18),o=r(19),s=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":s&&s in Object(t)?n(t):o(t)}},function(t,e,r){var i=r(6),n=Object.prototype,o=n.hasOwnProperty,s=n.toString,a=i?i.toStringTag:void 0;t.exports=function(t){var e=o.call(t,a),r=t[a];try{t[a]=void 0;var i=!0}catch(t){}var n=s.call(t);return i&&(e?t[a]=r:delete t[a]),n}},function(t,e){var r=Object.prototype.toString;t.exports=function(t){return r.call(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e){var r=Object.prototype.hasOwnProperty,i=Object.prototype.toString;t.exports=function(t){if(null==t)return!0;if("boolean"==typeof t)return!1;if("number"==typeof t)return 0===t;if("string"==typeof t)return 0===t.length;if("function"==typeof t)return 0===t.length;if(Array.isArray(t))return 0===t.length;if(t instanceof Error)return""===t.message;if(t.toString==i)switch(t.toString()){case"[object File]":case"[object Map]":case"[object Set]":return 0===t.size;case"[object Object]":for(var e in t)if(r.call(t,e))return!1;return!0}return!1}},function(t,e,r){"use strict";var i;t.exports=function(t){return"string"==typeof t&&(i||(i=new RegExp('^[\\s\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"]+$'))).test(t)}},function(t,e,r){"use strict";(function(e){var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{},i=Object.create(r),n=/["&'<>]/;i.$escape=function(t){return function(t){var e=""+t,r=n.exec(e);if(!r)return t;var i="",o=void 0,s=void 0,a=void 0;for(o=r.index,s=0;o<e.length;o++){switch(e.charCodeAt(o)){case 34:a="&#34;";break;case 38:a="&#38;";break;case 39:a="&#39;";break;case 60:a="&#60;";break;case 62:a="&#62;";break;default:continue}s!==o&&(i+=e.substring(s,o)),s=o+1,i+=a}return s!==o?i+e.substring(s,o):i}(function t(e){"string"!=typeof e&&(e=null==e?"":"function"==typeof e?t(e.call(e)):JSON.stringify(e));return e}(t))},i.$each=function(t,e){if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)e(t[r],r);else for(var n in t)e(t[n],n)},t.exports=i}).call(this,r(3))},function(t,e,r){},function(t,e,r){"use strict";r.r(e);var i=r(0),n=r.n(i),o=(r(12),r(7)),s=r.n(o);var a={get:function(t){try{var e=window.localStorage.getItem(t);if(e){var r=JSON.parse(e);if(Array.isArray(r))return r}}catch(t){}return[]},set:function(t,e){try{window.localStorage.setItem(t,JSON.stringify(e))}catch(t){}}},c="https://bm.weajs.com/api/",u="https://movie.douban.com/subject/",l="https://book.douban.com/subject/",f="starred",h=r(1),d=r.n(h);var p={isEmpty:d.a,isValid:function(t){return!d()(t)},param2object:function(t){var e={};if(t=t.replace(/^\?/,""),d()(t))return e;var r=t.split("&");return r.length>0&&r.forEach((function(t){var r=t.split("=");if(r.length>0){var i=r[1];e[r[0]]=d()(i)?"":decodeURIComponent(i)}})),e},object2param:function(t){var e=[],r=Object.keys(t);return r.length>0&&r.forEach((function(r){e.push(r+"="+t[r])})),e.join("&")}};function g(){return(g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}var b=r(8),v=r.n(b),y=r(9),m=r.n(y),w=function(){function t(t){this.app=t,this.app.showCategories&&(this.apiUrl=this.app.apiUrl+"/categories",this.cacheKey=(this.app.namespace+"_categories").toUpperCase(),this.location=this.parseLocation(),this.app.category=this.location.query[this.cacheKey],this.$container=n()(v()()).prependTo(this.app.$container),this.$list=this.$container.find("ul"),this.getData())}var e=t.prototype;return e.parseLocation=function(){var t=window.location;return{href:t.href,origin:t.origin+t.pathname,query:this.app.utils.param2object(t.search)}},e.getData=function(){var t=this,e=this.cache;if(e){var r=this.app.store.get(this.cacheKey);this.render(r)}n.a.ajax({url:this.apiUrl,data:{secret:this.app.secret},dataType:"json",success:function(r){e&&t.app.store.set(t.cacheKey,r),t.render(r)},error:this.errorLogger})},e.render=function(t){var e=this,r=this.app.utils.isEmpty,i=[{name:"全部",url:this.getCategoryUrl(""),active:r(this.app.category)}];this.app.showStarred&&i.push({name:"推荐",url:this.getCategoryUrl(f),active:this.app.category===f}),this.$list.append(m()({categories:[].concat(i,(r(this.app.categoryFilters)?t:this.app.categoryFilters.filter((function(e){return t.includes(e)}))).map((function(t){var r=e.getCategoryUrl(t);return{name:t,active:t===e.app.category,url:r}})))}))},e.getCategoryUrl=function(t){var e,r=this.location,i=r.origin,n=r.query;return i+"?"+this.app.utils.object2param(g({},n,((e={})[this.cacheKey]=encodeURIComponent(t),e)))},t}(),j=function(t){new w(t)},x=r(10),A=r.n(x),$=r(11),O=r.n($),S=function(){function t(t){var e=t.type,r=t.selector,i=t.secret,o=t.limit,s=t.showCategories,u=t.showStarred,l=t.categoryFilters,f=t.skeletonNum,h=t.noMoreText,d=t.cache,g=t.darkMode;this.secret=i,this.assert(p.isValid(i),i+" is not a valid secret"),this.isMovieRequest="movies"===e,this.type=this.isMovieRequest?"movies":"books",this.apiUrl=c+this.type,this.noMoreText=h||"",this.skeletonNum=f||5,this.page=1,this.limit=o||30,this.isLoading=!1,this.category=void 0,this.showStarred=void 0===u||!!u,this.categoryFilters=l||[],this.showCategories=!!this.isMovieRequest&&!!s,this.cache=void 0===d||!!d,this.namespace=("bmdb_"+this.type).toUpperCase(),this.cacheKey=null,this.darkMode=void 0===g||!!g,this.store=a,this.utils=p,this.$container=n()(r),this.assert(this.$container.length>0,r+" is not a valid selector"),this.$window=n()(window),this.setViews(),this.addPlugin(j),this.getData(),this.bindScrollEvent()}var e=t.prototype;return e.setViews=function(){this.$container.append(A()({darkMode:this.darkMode,skeletons:Array.from({length:this.skeletonNum})})),this.darkMode&&this.$container.addClass("bmdb-dark-mode"),this.$list=this.$container.find(".bmdb-list .bmdb-ul"),this.$loader=this.$container.find(".bmdb-loader")},e.bindScrollEvent=function(){var t=this;this.scrollFn=s()((function(){t.onScroll()}),16),this.$window.on("scroll",this.scrollFn)},e.onScroll=function(){this.$window.scrollTop()+this.$window.height()+100>this.$loader.offset().top&&this.getData()},e.getData=function(){var t=this;if(!this.isLoading){this.isLoading=!0;var e=this.cache&&1===this.page;if(e){this.cacheKey=this.category?this.namespace+":"+this.category:this.namespace;var r=this.store.get(this.cacheKey);this.render(r)}var i={page:this.page,limit:this.limit,secret:this.secret};this.category&&(this.category===f?i.starred=!0:i.category=this.category),n.a.ajax({url:this.apiUrl,data:i,dataType:"json",success:function(r){r.length<t.limit&&(t.setNoMoreDataView(),t.offScrollEvent()),e&&(t.$list.html(""),t.store.set(t.cacheKey,r)),t.render(r),t.page+=1,t.isLoading=!1},error:function(e){t.isLoading=!1,t.errorLogger(e)}})}},e.render=function(t){if(t.length>0){var e=this.isMovieRequest?u:l;t=t.map((function(t){var r=Math.round(t.rating/2);return t.doubanUrl=e+t.doubanId,t.stars=Array.from({length:5}).map((function(t,e){return e+1<=r})),t.rating=t.rating.includes(".")?t.rating:t.rating+".0",t}));var r=n()(O()({data:t}));this.$list.append(r),r.find("img.bmdb-cover-image").lazyload({src:"data-cover"})}},e.setNoMoreDataView=function(){this.$loader.text(this.noMoreText)},e.offScrollEvent=function(){this.$window.off("scroll",this.scrollFn)},e.addPlugin=function(t){t(this)},e.assert=function(t,e){if(!t)throw new Error(e)},e.errorLogger=function(t){console.error("[BMDB]",t)},t}();r(24),e.default=S}]).default}));
//# sourceMappingURL=Bmdb.min.js.map